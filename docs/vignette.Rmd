---
title: "traveltimeR - API Wrapper for the Traveltime API"
output: 
  prettydoc::html_pretty:
    theme: cayman
    highlight: github
    toc: true 
    number_sections: true 
    df_print: paged
---

Gets isochrones for traveltimemaps from Traveltime API directly into R as sf-objects. The isochrones display how far you can travel from a certain location within a given timeframe. Supports several modes of transport. 

https://api.traveltimeapp.com/

__GET an API-KEY__ here: http://docs.traveltimeplatform.com/overview/getting-keys/

For non-commercial use the usage of the API is free up to 10'000 queries a month (max 30 queries per min). For commercial use (e.g. to integrate the API into a website) a license is needed. 


```{r, message=F, warning=F}
devtools::install_github("tlorusso/traveltimeR")

# load packages
if (!require("pacman")) install.packages("pacman")
pacman::p_load(dplyr, purrr, sf, mapview, traveltimeR)

```

You can easily retrieve the isochrones with the get_traveltime function. Find a list of supported countries here: http://docs.traveltimeplatform.com/overview/supported-countries/

# querying the Traveltime-API with get_traveltime
```{r, echo=TRUE, eval=FALSE}
# retrieve data via request 

# The following transport modes are supported:

# "cycling"", "cycling_ferry", "driving", "driving+train", "driving_ferry", "public_transport", 
# "walking", "walking+coach", "walking_bus", "walking_ferry" or "walking_train".

# how far can you go by public transport within 30 minutes?
traveltime30 <- get_traveltime(appId="YourappId",
               apiKey="YourAPIKey",
               location=c(47.378610,8.54000),
               traveltime=1800,
               type="public_transport",
               departure="2018-10-05T08:00:00Z")

# ... and within 60 minutes?
traveltime60 <- get_traveltime(appId="YourappId",
               apiKey="YourAPIKey",
               location=c(47.378610,8.54000),
               traveltime=3600,
               type="public_transport",
               departure="2018-10-05T08:00:00Z")

```

```{r, echo=FALSE, eval=TRUE}
traveltime30 <- readRDS("traveltime30.RDS")
traveltime60 <- readRDS("traveltime60.RDS")

traveltimes <- readRDS("~/github/traveltimeR/traveltimes.RDS")
```

How far you can go from Zurich Mainstation by public transport within 30min visualized with the mapview-package.

# taking a glimpse at the isochrones with mapview
```{r}

# mapview(traveltime, zcol="traveltime",burst = TRUE)


m1 = mapview(traveltime60,  col.regions = c("grey"))
m1 + traveltime30


```


# plot a traveltime-map with ggmap / geom_sf
```{r, warning=F, message=F, eval=FALSE}

library(ggmap)

basemap2 <- get_stamenmap(bbox = unname(st_bbox(traveltime60)),maptype = "toner-hybrid")

traveltimes <-c(1800,2400,3600) %>% 
              map(.,~get_traveltime(appId="YourAppId",
                    apiKey="YourApiKey",
                    location=c(47.378610,8.54000),
                    traveltime=.x,
                    type="public_transport",
                    departure="2018-10-05T08:00:00Z"))


#map_dfr does not work properly with the resulting sf objects (sfc_polygons)
traveltimes <- do.call(rbind,traveltimes)
```


```{r, warning=F, message=F}

library(ggmap)

#get basemap with ggmap
basemap2 <- get_stamenmap(bbox = unname(st_bbox(traveltimes)),maptype = "toner-hybrid")

#plot
ggmap(basemap2)+
  geom_sf(data=traveltimes,aes(fill=as.factor(traveltime/60)),inherit.aes = FALSE, colour=NA, alpha=0.4)+
  theme_void()+
  coord_sf(datum = NA)+
  scale_fill_viridis_d(name="min")

  
```


